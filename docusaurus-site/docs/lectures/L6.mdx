---
id: l6
title: "Lecture 6: Unification and Lifting"
sidebar_label: "Lecture 6: Unification and Lifting"
---

Laura Kovács

## First-Order Logic: Exercises
Which of the following statements are true?

1. First-order logic is an <span class="redbold">extension of propositional logic</span>.
2. First-order logic is <span class="redbold">NP-complete</span>.
3. In first-order logic you can use <span class="redbold">quantifiers over sets</span>.
4. First-order logic is <span class="redbold">decidable</span>.
5. One can <span class="redbold">axiomatise naturals</span> in first-order logic.
6. Having proofs is <span class="redbold">good</span>.

## Substitution
- A <span class="redbold">substitution</span> $\theta$ is a mapping from variables to terms such that the set $\{x \mid \theta(x) \neq x\}$ is finite. This set is the <span class="redbold">domain</span> of $\theta$.
- We write $\{\;x_1 \mapsto t_1,\ldots,x_n \mapsto t_n\;\}$, where $x_1,\ldots,x_n$ are pairwise different variables, for the substitution $\theta$ that maps every $x_i$ to $t_i$ and leaves all other variables unchanged.
- Applying a substitution $\theta$ to an expression $E$ means replacing each $x_i$ by $t_i$ simultaneously; we denote the result by $E\theta$.
- Substitutions are functions, so we can compose them. We write $\sigma\tau$ (rather than $\tau \circ \sigma$), and we always have $E(\sigma\tau) = (E\sigma)\tau$.

## Example
Consider the expression $E = p(x,y,f(a))$ and the substitution $\theta = \{x \mapsto b,\; y \mapsto x\}$.  
What is $E\theta$?

## Substitution Composition
Suppose we have two substitutions
$$
\theta_1 = \{x_1 \mapsto s_1,\ldots,x_m \mapsto s_m\}, \qquad
\theta_2 = \{y_1 \mapsto t_1,\ldots,y_n \mapsto t_n\}.
$$
To compute $\theta_1\theta_2$:

- Start from $\{x_1 \mapsto s_1\theta_2,\ldots,x_m \mapsto s_m\theta_2,\; y_1 \mapsto t_1,\ldots,y_n \mapsto t_n\}$.
- Delete every $y_i \mapsto t_i$ with $y_i \in \{x_1,\ldots,x_m\}$.
- Delete every $x_i \mapsto s_i\theta_2$ for which $x_i = s_i\theta_2$.

The result is $\theta_1\theta_2$.

## Example
Let
$$
\theta_1 = \{x \mapsto f(y),\; y \mapsto z\}, \qquad
\theta_2 = \{x \mapsto a,\; y \mapsto b,\; z \mapsto y\}.
$$
What is $\theta_1\theta_2$?

## Instances and Ground Instances
An <span class="redbold">instance</span> of an expression $E$ (term, atom, literal, or clause) is obtained by applying a substitution to $E$.
- Some instances of the term $f(x,a,g(x))$ are $f(x,a,g(x))$, $f(y,a,g(y))$, $f(a,a,g(a))$, and $f(g(b),a,g(g(b)))$.
- The term $f(b,a,g(c))$ is not an instance of $f(x,a,g(x))$.
- A <span class="redbold">ground instance</span> is an instance that contains no variables.

## Herbrand's Theorem
For a set of clauses $S$, let $S^*$ denote the set of ground instances of clauses in $S$.

<span class="greenbold">Theorem.</span> Let $\Sigma$ be a signature with at least one constant symbol and let $S$ be a set of universal clauses over $\Sigma$. The following are equivalent:

1. <span class="bluebold">$S$ is unsatisfiable.</span>
2. <span class="bluebold">$S^*$ is unsatisfiable.</span>

By compactness of first-order logic, this is equivalent to:

3. <span class="bluebold">There exists a finite unsatisfiable set of ground instances of clauses in $S$.</span>

Thus the theorem reduces checking unsatisfiability of arbitrary clause sets to checking unsatisfiability of sets of <span class="redbold">ground clauses</span>, even though $S^*$ can be infinite.

## Lifting
<span class="redbold">Lifting</span> is a technique for proving completeness theorems:

1. Prove completeness of the inference system for sets of <span class="bluebold">ground</span> clauses.
2. <span class="redbold">Lift</span> the proof to the non-ground case.

## Lifting Example
Consider the non-ground clauses $p(x,a) \lor q_1(x)$ and $\neg p(y,z) \lor q_2(y,z)$. When the signature contains function symbols, both clauses have infinitely many ground instances:
$$
\{\,p(r,a) \lor q_1(r) \mid r \text{ is ground}\,\}, \qquad
\{\,\neg p(s,t) \lor q_2(s,t) \mid s,t \text{ are ground}\,\}.
$$
We can resolve ground instances iff $r=s$ and $t=a$, yielding inferences such as
$$
\frac{p(s,a) \lor q_1(s) \qquad \neg p(s,a) \lor q_2(s,a)}{q_1(s) \lor q_2(s,a)}(\text{BR}),
$$
but there are infinitely many such inferences.

## Lifting Idea
Represent an <span class="redbold">infinite number of ground inferences</span> with a <span class="redbold">single non-ground inference</span>:
$$
\frac{p(x,a) \lor q_1(x) \qquad \neg p(y,z) \lor q_2(y,z)}{q_1(y) \lor q_2(y,a)}(\text{BR}).
$$
Is this always possible?

## Yes!
For the inference
$$
\frac{p(x,a) \lor q_1(x) \qquad \neg p(y,z) \lor q_2(y,z)}{q_1(y) \lor q_2(y,a)}(\text{BR}),
$$
the substitution $\{x \mapsto y,\; z \mapsto a\}$ solves the “equation” $p(x,a) = p(y,z)$, so the lifted inference represents all its ground instances.

## Lifting Lemma for $\mathbb{BR}$
<span class="bluebold">Idea.</span> Represent infinitely many ground inferences by a single non-ground inference.

For binary resolution $\mathbb{BR}$ with selection:
- Work with <span class="redbold">non-ground clauses</span>.
- Generalize the notion of “same” ground atoms to <span class="redbold">unifiability</span> of non-ground atoms.
- Compute <span class="redbold">most general unifiers (mgu)</span> only.

<span class="greenbold">Lifting Lemma.</span> Let $C$ and $D$ be clauses that share no variables. If a ground binary resolution inference
$$
\frac{C\sigma_1 \qquad D\sigma_2}{C'}(\text{ground BR})
$$
exists, then there is a substitution $\sigma$ such that a non-ground inference
$$
\frac{C \qquad D}{C''}(\text{BR})
$$
and $C' = C''\sigma$.

Similar lifting lemmas exist for each inference of $\mathbb{BR}$ and of the superposition system $\mathbb{S}\mathrm{up}$.

## What Should We Lift?
- The ordering $\succ$.
- The selection function $\sigma$.
- The calculus $\mathbb{S}\mathrm{up}^{\mathrm{sat}}$.

Most importantly, lifting requires solving equations $s = t$ between terms and between atoms, which we do using <span class="redbold">most general unifiers</span>.

## Unifier
A <span class="redbold">unifier</span> of expressions $s_1$ and $s_2$ is a substitution $\theta$ with $s_1\theta = s_2\theta$.  
Equivalently, it is a solution of the “equation” $s_1 = s_2$. For systems of equations $s_1 = s'_1,\ldots,s_n = s'_n$, a substitution that satisfies all equations simultaneously is a <span class="redbold">simultaneous unifier</span>.

## Most General Unifiers
A solution $\theta$ to a set of equations $E$ is <span class="redbold">most general</span> if, for every other solution $\sigma$, there exists a substitution $\tau$ with $\theta\tau = \sigma$. The same notion applies to unifiers.

Consider the terms $f(x_1,g(x_1),x_2)$ and $f(y_1,y_2,y_2)$. Two unifiers are
$$
\theta_1 = \{y_1 \mapsto x_1,\; y_2 \mapsto g(x_1),\; x_2 \mapsto g(x_1)\},
\qquad
\theta_2 = \{y_1 \mapsto a,\; y_2 \mapsto g(a),\; x_2 \mapsto g(a),\; x_1 \mapsto a\}.
$$
Both substitutions make the terms equal, but only $\theta_1$ is an mgu; $\theta_2$ is obtained from it by instantiating $x_1$ with $a$.

## Unification Algorithm
Let $E$ be a finite set of equations. An equation $x = t$ in $E$ is <span class="redbold">isolated</span> if $x$ occurs nowhere else in $E$.

1. While $E$ contains a non-isolated equation $s = t$, perform one of the following actions:
   - If $s$ and $t$ are syntactically identical, remove the equation.
   - If the equation is $x = t$:
     - If $x$ occurs in $t$, fail (no unifier).
     - Otherwise, replace every other occurrence of $x$ in $E$ by $t$.
   - If the equation is $t = x$, swap the sides and handle it as the previous case.
   - If both sides are distinct constants, fail.
   - If exactly one side is a constant and the other is a compound term, fail.
   - If the top symbols are different function symbols, fail.
   - If both sides are $f(s_1,\ldots,s_n)$ and $f(t_1,\ldots,t_n)$, replace the equation by the set $\{s_1 = t_1,\ldots,s_n = t_n\}$.
2. Once only isolated equations $\{x_1 = r_1,\ldots,x_\ell = r_\ell\}$ remain, return the substitution $\{x_1 \mapsto r_1,\ldots,x_\ell \mapsto r_\ell\}$.

## Examples
Try running the algorithm on:
- $\{\,h\big(g(f(x),a)\big) = h\big(g(y,y)\big)\,\}$
- $\{\,h(f(y),y,f(z)) = h(z,f(x),x)\,\}$
- $\{\,h\big(g(f(x),z)\big) = h\big(g(y,y)\big)\,\}$

## Properties
<span class="greenbold">Theorem.</span> Suppose we run the algorithm on $s = t$.

- If $s$ and $t$ are unifiable, the algorithm terminates and outputs a most general unifier of $s$ and $t$.
- If $s$ and $t$ are not unifiable, the algorithm terminates with failure.

We often write $\operatorname{mgu}(s,t)$ for a most general unifier and $\operatorname{mgs}(E)$ for a most general solution of the equation set $E$.

## Exercise
Consider the trivial systems of equations $\varnothing$ and $\{a = a\}$.
- What is the set of all solutions?
- What is the set of most general solutions?

## Revisiting the Ingredients of Lifting
- Lift the ordering $\succ$.
- Lift the selection function $\sigma$.
- Lift the calculus $\mathbb{S}\mathrm{up}^{\mathrm{sat}}$ (thanks to the lifting lemmas).

Most importantly, lifting works because we use <span class="redbold">most general unifiers</span>.

